<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ghana EdTech Strategy Document</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600&family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <!-- Hotjar Tracking Code for Ghana EdTech Strategy -->
    <script>
      (function (h, o, t, j, a, r) {
        h.hj =
          h.hj ||
          function () {
            (h.hj.q = h.hj.q || []).push(arguments);
          };
        h._hjSettings = { hjid: 6642332, hjsv: 6 };
        a = o.getElementsByTagName("head")[0];
        r = o.createElement("script");
        r.async = 1;
        r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
        a.appendChild(r);
      })(window, document, "https://static.hotjar.com/c/hotjar-", ".js?sv=");
    </script>
    <!-- End of hotjar tracking code -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
      :root {
        --bg: #e8e8e8;
        --page-bg: #ffffff;
        --sidebar-width: 280px;
        --primary-color: #2b6cb0;
        --text-primary: #1a1a1a;
        --text-secondary: #4a4a4a;
        --accent: #d4a574;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        margin: 0;
        font-family: "Lora", Georgia, serif;
        background: var(--bg);
        color: var(--text-primary);
      }

      .layout {
        display: flex;
        height: 100vh;
      }

      /* Sidebar Navigation */
      .sidebar {
        width: var(--sidebar-width);
        background: white;
        border-right: 1px solid #d0d0d0;
        height: 100%;
        overflow-y: auto;
        position: fixed;
        left: 0;
        top: 0;
        padding: 0;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .sidebar-header {
        padding: 1.25rem;
        border-bottom: 2px solid #e2e8f0;
        position: sticky;
        top: 0;
        background: white;
        z-index: 10;
      }

      .back-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: none;
        border: none;
        color: var(--primary-color);
        font-size: 0.9rem;
        font-weight: 600;
        cursor: pointer;
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        transition: all 0.2s;
        margin-bottom: 0.75rem;
        font-family: "Inter", sans-serif;
      }

      .back-btn:hover {
        background: #edf2f7;
        color: #1e3a5f;
      }

      .sidebar-title {
        font-size: 0.95rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 0;
        font-family: "Inter", sans-serif;
        letter-spacing: 0.5px;
      }

      .sidebar-content {
        padding: 1.25rem 0;
      }

      .sidebar-section {
        padding: 0 0.75rem;
        margin-bottom: 1.75rem;
      }

      .sidebar-section h3 {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #888;
        margin: 0 1rem 0.75rem;
        font-family: "Inter", sans-serif;
        font-weight: 600;
      }

      .nav-links {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .nav-links li {
        margin-bottom: 0.25rem;
      }

      .nav-links a {
        display: block;
        padding: 0.6rem 1rem;
        color: var(--text-secondary);
        text-decoration: none;
        border-radius: 0.375rem;
        font-size: 0.9rem;
        transition: all 0.2s;
        border-left: 3px solid transparent;
        font-family: "Inter", sans-serif;
      }

      .nav-links a:hover {
        background: #f0f4f8;
        color: var(--primary-color);
        padding-left: 1.1rem;
      }

      .nav-links a.active {
        background: #e8f1ff;
        color: var(--primary-color);
        font-weight: 600;
        border-left-color: var(--primary-color);
      }

      /* Main Content */
      .main-content {
        margin-left: var(--sidebar-width);
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .topbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        column-gap: 0.75rem;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(90deg, #2c5282, #1a365d);
        color: white;
        height: 50px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 200;
      }

      .title {
        font-size: 0.92rem;
        font-weight: 600;
        font-family: "Inter", sans-serif;
        margin-right: 0.75rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: inherit;
        text-decoration: none;
      }

      .meta {
        font-size: 0.78rem;
        opacity: 0.9;
        font-family: "Inter", sans-serif;
        white-space: nowrap;
      }

      .container {
        flex: 1;
        overflow: hidden;
        background: var(--bg);
      }

      .viewer-wrap {
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 2rem 1rem;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
      }

      .pdf-loading {
        font-family: "Inter", sans-serif;
        color: var(--text-secondary);
        font-size: 0.95rem;
        text-align: center;
        padding: 2rem 0;
      }

      .toolbar {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1.5rem;
        background: white;
        border-bottom: 1px solid #e0e0e0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .btn {
        background: var(--primary-color);
        color: white;
        padding: 0.6rem 1rem;
        border-radius: 0.375rem;
        text-decoration: none;
        border: none;
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 500;
        transition: all 0.2s;
        font-family: "Inter", sans-serif;
      }

      .btn:hover {
        background: #1e3a5f;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* PDF-style Document (HTML sections) */
      .document-wrapper {
        width: 100%;
        max-width: 850px;
        display: flex;
        flex-direction: column;
        gap: 2rem;
        padding: 0;
        background: transparent;
        box-shadow: none;
      }

      .pdf-canvas {
        display: block;
        box-shadow: 0 0 18px rgba(0, 0, 0, 0.12);
        border-radius: 2px;
        margin: 0 auto 2rem;
        background: white;
      }

      .pdf-page-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 850px;
        margin: 0 auto 2rem;
        border-radius: 2px;
        background: white;
        box-shadow: 0 0 14px rgba(0, 0, 0, 0.08);
      }

      .document-section {
        scroll-margin-top: 100px;
        margin-bottom: 2.5rem;
      }

      .document-section h2 {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-color);
        margin: 2rem 0 1.25rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--accent);
        page-break-after: avoid;
      }

      .document-section h3 {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 1.5rem 0 0.75rem;
        page-break-after: avoid;
      }

      .document-section p {
        font-size: 1rem;
        line-height: 1.8;
        color: var(--text-primary);
        margin-bottom: 1rem;
        text-align: justify;
        text-indent: 1.5rem;
      }

      .document-section p:first-of-type {
        text-indent: 0;
      }

      .document-section ul,
      .document-section ol {
        font-size: 1rem;
        line-height: 1.8;
        color: var(--text-primary);
        margin: 1rem 0 1rem 1.5rem;
      }

      .document-section li {
        margin-bottom: 0.75rem;
      }

      .quote {
        border-left: 4px solid var(--accent);
        padding: 1rem 0 1rem 1.5rem;
        margin: 1.5rem 0;
        font-size: 0.95rem;
        font-style: italic;
        color: #555;
        background: #fafaf8;
      }

      .highlight-box {
        background: #f0f4f8;
        border: 1px solid var(--primary-color);
        border-left: 4px solid var(--primary-color);
        padding: 1.25rem;
        margin: 1.5rem 0;
        border-radius: 0.375rem;
      }

      .highlight-box h4 {
        margin-top: 0;
        color: var(--primary-color);
        font-family: "Inter", sans-serif;
      }

      .page-number {
        text-align: center;
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid #e0e0e0;
        font-size: 0.85rem;
        color: #999;
        font-family: "Inter", sans-serif;
      }

      /* Progress indicator */
      .progress-indicator {
        position: fixed;
        top: 50px;
        left: var(--sidebar-width);
        right: 0;
        height: 3px;
        background: #e2e8f0;
        z-index: 100;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary-color), var(--accent));
        width: 0;
        transition: width 0.3s ease;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          width: 70%;
          max-width: 280px;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
        }

        .progress-indicator {
          left: 0;
        }

        .viewer-wrap {
          padding: 1rem 0.5rem;
        }

        .document-wrapper {
          width: 100%;
        }

        .doc-title {
          font-size: 1.6rem;
        }

        .document-section h2 {
          font-size: 1.4rem;
        }
      }

      @media (max-width: 600px) {
        .layout {
          height: 100vh;
          min-height: 100vh;
          flex-direction: column;
        }

        .container {
          height: calc(100vh - 50px);
          overflow: hidden;
        }

        .viewer-wrap {
          height: 100%;
          min-height: auto;
          overflow-y: auto;
          align-items: stretch;
          padding: 1.5rem 1rem;
        }

        .document-wrapper {
          width: 100%;
        }

        .title {
          font-size: 0.82rem;
        }

        .meta {
          font-size: 0.72rem;
        }

        .title {
          margin-right: 0.5rem;
        }
      }

      .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        color: white;
        font-size: 1.25rem;
        padding: 0;
        cursor: pointer;
      }

      @media (max-width: 768px) {
        .mobile-menu-btn {
          display: block;
        }
      }

      /* Scrollbars */
      .sidebar::-webkit-scrollbar {
        width: 6px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: #f8fafc;
      }

      .sidebar::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 3px;
      }

      .sidebar::-webkit-scrollbar-thumb:hover {
        background: #a0aec0;
      }

      .viewer-wrap::-webkit-scrollbar {
        width: 8px;
      }

      .viewer-wrap::-webkit-scrollbar-track {
        background: #e8e8e8;
      }

      .viewer-wrap::-webkit-scrollbar-thumb {
        background: #999;
        border-radius: 4px;
      }

      .viewer-wrap::-webkit-scrollbar-thumb:hover {
        background: #666;
      }

      /* Print Styles */
      @media print {
        .sidebar,
        .topbar,
        .toolbar,
        .progress-indicator,
        .feedback-widget {
          display: none;
        }

        .main-content {
          margin-left: 0;
        }

        .viewer-wrap {
          padding: 0;
        }

        .document-page {
          page-break-after: always;
          box-shadow: none;
        }
      }

      /* Feedback Widget Styles */
      .feedback-widget {
        position: fixed;
        top: 70px;
        right: 24px;
        z-index: 1100;
        font-family: "Inter", sans-serif;
      }

      .feedback-toggle {
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--primary-color);
        color: white;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition:
          transform 0.2s ease,
          box-shadow 0.2s ease,
          background 0.2s ease;
      }

      .feedback-toggle:hover {
        transform: scale(1.08);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        background: #1e4a8a;
      }

      .feedback-toggle:focus {
        outline: 3px solid var(--accent);
        outline-offset: 2px;
      }

      .feedback-toggle svg {
        width: 24px;
        height: 24px;
      }

      /* Pulse animation for onboarding */
      @keyframes feedback-pulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        50% {
          transform: scale(1.1);
          box-shadow: 0 6px 20px rgba(212, 165, 116, 0.5);
        }
      }

      @keyframes tooltip-pulse {
        0%,
        100% {
          transform: translateY(0) scale(1);
          box-shadow: 0 4px 12px rgba(212, 165, 116, 0.3);
        }
        50% {
          transform: translateY(-3px) scale(1.02);
          box-shadow: 0 6px 20px rgba(212, 165, 116, 0.5);
        }
      }

      .feedback-toggle.pulsing {
        animation: feedback-pulse 1.5s ease-in-out infinite;
        background: var(--accent);
      }

      .feedback-toggle.pulsing:hover {
        animation: none;
        transform: scale(1.08);
        background: #c4956a;
      }

      /* Tooltip callout bubble */
      .feedback-tooltip {
        position: absolute;
        top: 70px;
        right: 0;
        background: var(--accent);
        color: white;
        padding: 10px 14px;
        border-radius: 8px;
        font-size: 0.85rem;
        font-weight: 500;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(212, 165, 116, 0.3);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition:
          opacity 0.3s ease,
          visibility 0.3s ease;
        pointer-events: none;
      }

      .feedback-tooltip.visible {
        opacity: 1;
        visibility: visible;
        animation: tooltip-pulse 1.5s ease-in-out infinite;
      }

      /* Tooltip arrow pointing up */
      .feedback-tooltip::after {
        content: "";
        position: absolute;
        top: -8px;
        right: 20px;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-bottom: 8px solid var(--accent);
      }

      .feedback-panel {
        position: absolute;
        top: 70px;
        right: 0;
        width: 320px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px) scale(0.95);
        transition:
          opacity 0.25s ease,
          transform 0.25s ease,
          visibility 0.25s ease;
      }

      .feedback-panel.expanded {
        opacity: 1;
        visibility: visible;
        transform: translateY(0) scale(1);
      }

      .feedback-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 14px 16px;
        border-bottom: 1px solid #e2e8f0;
      }

      .feedback-header h3 {
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
        color: var(--text-primary);
      }

      .feedback-close {
        width: 28px;
        height: 28px;
        border: none;
        background: #f1f5f9;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1.25rem;
        line-height: 1;
        color: #64748b;
        display: flex;
        align-items: center;
        justify-content: center;
        transition:
          background 0.2s ease,
          color 0.2s ease;
      }

      .feedback-close:hover {
        background: #e2e8f0;
        color: var(--text-primary);
      }

      .feedback-close:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 1px;
      }

      .feedback-context {
        padding: 10px 16px;
        background: #f8fafc;
        font-size: 0.8rem;
        color: #64748b;
        border-bottom: 1px solid #e2e8f0;
      }

      .feedback-form {
        padding: 16px;
      }

      .feedback-field {
        margin-bottom: 14px;
      }

      .feedback-field label {
        display: block;
        font-size: 0.85rem;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 6px;
      }

      .feedback-field textarea,
      .feedback-field select {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 0.9rem;
        font-family: "Inter", sans-serif;
        transition:
          border-color 0.2s ease,
          box-shadow 0.2s ease;
        box-sizing: border-box;
      }

      .feedback-field textarea {
        resize: vertical;
        min-height: 80px;
      }

      .feedback-field textarea:focus,
      .feedback-field select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(43, 108, 176, 0.15);
      }

      .feedback-field textarea::placeholder {
        color: #9ca3af;
      }

      .feedback-submit {
        width: 100%;
        padding: 12px 16px;
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 0.9rem;
        font-weight: 600;
        font-family: "Inter", sans-serif;
        cursor: pointer;
        transition:
          background 0.2s ease,
          transform 0.1s ease;
      }

      .feedback-submit:hover {
        background: #1e4a8a;
      }

      .feedback-submit:active {
        transform: scale(0.98);
      }

      .feedback-submit:focus {
        outline: 3px solid var(--accent);
        outline-offset: 2px;
      }

      .feedback-submit:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .feedback-status {
        padding: 0 16px 16px;
        font-size: 0.85rem;
        text-align: center;
      }

      .feedback-status:empty {
        display: none;
      }

      .feedback-status.feedback-success {
        color: #059669;
      }

      .feedback-status.feedback-error {
        color: #dc2626;
      }

      /* Feedback Widget Mobile Responsive */
      @media (max-width: 768px) {
        .feedback-widget {
          top: 60px;
          right: 16px;
        }

        .feedback-toggle {
          width: 50px;
          height: 50px;
        }

        .feedback-toggle svg {
          width: 22px;
          height: 22px;
        }

        .feedback-panel {
          width: calc(100vw - 32px);
          max-width: 320px;
          right: 0;
          top: 62px;
        }
      }

      @media (max-width: 480px) {
        .feedback-panel {
          width: calc(100vw - 32px);
          right: -8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <button class="back-btn" id="backBtn" title="Return to Documents">
            ← Back
          </button>
          <h3 class="sidebar-title">Contents</h3>
        </div>

        <div class="sidebar-content">
          <div class="sidebar-section">
            <h3>Front Matter</h3>
            <ul class="nav-links">
              <li>
                <a
                  href="#executive-summary"
                  class="nav-link active"
                  data-section="executive-summary"
                  >Executive Summary</a
                >
              </li>
              <li>
                <a
                  href="#introduction"
                  class="nav-link"
                  data-section="introduction"
                  >Introduction</a
                >
              </li>
              <li>
                <a href="#vision" class="nav-link" data-section="vision"
                  >Vision & Mission</a
                >
              </li>
            </ul>
          </div>

          <div class="sidebar-section">
            <h3>Thematic Areas</h3>
            <ul class="nav-links">
              <li>
                <a href="#governance" class="nav-link" data-section="governance"
                  >Governance & Management</a
                >
              </li>
              <li>
                <a
                  href="#infrastructure"
                  class="nav-link"
                  data-section="infrastructure"
                  >Infrastructure & Connectivity</a
                >
              </li>
              <li>
                <a href="#content" class="nav-link" data-section="content"
                  >Content Development</a
                >
              </li>
              <li>
                <a href="#capacity" class="nav-link" data-section="capacity"
                  >Capacity Building</a
                >
              </li>
              <li>
                <a href="#curriculum" class="nav-link" data-section="curriculum"
                  >Curriculum Integration</a
                >
              </li>
              <li>
                <a
                  href="#inclusivity"
                  class="nav-link"
                  data-section="inclusivity"
                  >Inclusivity & Access</a
                >
              </li>
              <li>
                <a
                  href="#cybersecurity"
                  class="nav-link"
                  data-section="cybersecurity"
                  >Cybersecurity & Data</a
                >
              </li>
              <li>
                <a href="#innovation" class="nav-link" data-section="innovation"
                  >Innovation & Learning</a
                >
              </li>
              <li>
                <a
                  href="#data-management"
                  class="nav-link"
                  data-section="data-management"
                  >Data Management & Reporting</a
                >
              </li>
              <li>
                <a
                  href="#data-protection"
                  class="nav-link"
                  data-section="data-protection"
                  >Data Protection</a
                >
              </li>
              <li>
                <a
                  href="#experiential"
                  class="nav-link"
                  data-section="experiential"
                  >Experiential Learning & Innovations</a
                >
              </li>
              <li>
                <a href="#monitoring" class="nav-link" data-section="monitoring"
                  >Monitoring & Evaluation</a
                >
              </li>
              <li>
                <a
                  href="#sustainability"
                  class="nav-link"
                  data-section="sustainability"
                  >Sustainable & Financially Inclusive Systems</a
                >
              </li>
              <li>
                <a href="#conclusion" class="nav-link" data-section="conclusion"
                  >Conclusion</a
                >
              </li>
            </ul>
          </div>

          <div class="sidebar-section">
            <h3>Appendix</h3>
            <ul class="nav-links">
              <li>
                <a
                  href="#definitions"
                  class="nav-link"
                  data-section="definitions"
                  >Definitions</a
                >
              </li>
              <li>
                <a
                  href="#abbreviations"
                  class="nav-link"
                  data-section="abbreviations"
                  >Abbreviations</a
                >
              </li>
            </ul>
          </div>
        </div>
      </aside>

      <!-- Progress Bar -->
      <div class="progress-indicator">
        <div class="progress-bar" id="readingProgress"></div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="topbar">
          <button class="mobile-menu-btn" id="menuToggle">☰</button>
          <a href="index.html" class="title" id="docTitle"
            >Ghana EdTech Strategy 2024</a
          >
          <div class="meta">Strategy Document</div>
        </div>

        <main class="container" role="main">
          <div class="viewer-wrap" id="viewerWrap">
            <div class="document-wrapper">
              <div class="pdf-loading" id="pdfLoading">Preparing document…</div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script>
      // DOM Elements
      const viewerWrap = document.getElementById("viewerWrap");
      const navLinks = document.querySelectorAll(".nav-link");
      const backBtn = document.getElementById("backBtn");
      const menuToggle = document.getElementById("menuToggle");
      const sidebar = document.querySelector(".sidebar");
      const progressBar = document.getElementById("readingProgress");
      const documentWrapper = document.querySelector(".document-wrapper");
      const docTitle = document.getElementById("docTitle");

      // Back button functionality
      backBtn.addEventListener("click", () => {
        window.location.href = "index.html#documents";
      });

      // Mobile menu toggle
      menuToggle.addEventListener("click", () => {
        sidebar.classList.toggle("active");
      });

      // Close sidebar on link click (mobile)
      navLinks.forEach((link) => {
        link.addEventListener("click", () => {
          if (window.innerWidth <= 768) {
            sidebar.classList.remove("active");
          }
        });
      });

      // On mobile/tablet, tapping the title returns to the home page
      if (docTitle) {
        docTitle.addEventListener("click", (event) => {
          if (window.innerWidth <= 1024) {
            event.preventDefault();
            window.location.href = "index.html";
          } else {
            event.preventDefault();
          }
        });
      }

      // ------------------- PDF.js integration -------------------
      // Use the attached PDF as the source. This will render each page
      // as a canvas appended to .document-wrapper to create a continuous scroll.
      let pdfDoc = null;
      let renderedPages = new Set();
      let pageCanvases = {};
      let currentScale = 1;
      let fitToWidth = true;

      // Set up PDF.js worker
      if (window.pdfjsLib) {
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
      }

      // Helper: create and render a page canvas
      function renderPage(pageNum) {
        if (renderedPages.has(pageNum) || !pdfDoc) return Promise.resolve();

        return pdfDoc.getPage(pageNum).then((page) => {
          // compute scale to fit container width when requested
          const containerWidth = Math.max(300, documentWrapper.clientWidth - 4);
          let viewport = page.getViewport({ scale: 1 });
          let scale = currentScale;
          if (fitToWidth) {
            scale = containerWidth / viewport.width;
            viewport = page.getViewport({ scale });
          } else {
            viewport = page.getViewport({ scale });
          }

          // create canvas
          const canvas = document.createElement("canvas");
          canvas.className = "pdf-canvas";
          canvas.dataset.pageNum = pageNum;
          // Set size for crisp rendering on high-DPI
          const outputScale = window.devicePixelRatio || 1;
          canvas.width = Math.floor(viewport.width * outputScale);
          canvas.height = Math.floor(viewport.height * outputScale);
          canvas.style.width = Math.floor(viewport.width) + "px";
          canvas.style.height = Math.floor(viewport.height) + "px";

          const ctx = canvas.getContext("2d");
          if (outputScale !== 1) {
            ctx.setTransform(outputScale, 0, 0, outputScale, 0, 0);
          }

          const renderContext = {
            canvasContext: ctx,
            viewport: viewport,
          };

          // insert a placeholder while rendering
          const placeholder = document.createElement("div");
          placeholder.className = "pdf-page-placeholder";
          placeholder.style.height = Math.floor(viewport.height) + "px";
          placeholder.style.width = "100%";

          // Append canvas (after rendering we replace placeholder)
          documentWrapper.appendChild(placeholder);

          return page.render(renderContext).promise.then(() => {
            documentWrapper.replaceChild(canvas, placeholder);
            pageCanvases[pageNum] = canvas;
            renderedPages.add(pageNum);
            updatePageCounter();
            return canvas;
          });
        });
      }

      function renderAllPages() {
        if (!pdfDoc) return;
        documentWrapper.innerHTML = "";
        renderedPages.clear();
        pageCanvases = {};

        const renderSequential = (pageNum) => {
          if (pageNum > pdfDoc.numPages) {
            updatePageCounter();
            return;
          }

          renderPage(pageNum)
            .then(() => {
              renderSequential(pageNum + 1);
            })
            .catch(console.error);
        };

        renderSequential(1);
      }

      // Update page counter / progress based on which canvas is visible
      function updatePageCounter() {
        if (!pdfDoc) return;

        const scrollTop = viewerWrap.scrollTop;
        const viewportHeight = viewerWrap.clientHeight;
        let currentPage = 1;

        for (let i = 1; i <= pdfDoc.numPages; i++) {
          const canvas = pageCanvases[i];
          if (canvas) {
            const canvasTop = canvas.offsetTop;
            const canvasBottom = canvasTop + canvas.offsetHeight;
            if (scrollTop + viewportHeight * 0.25 >= canvasTop) {
              currentPage = i;
            }
            if (scrollTop < canvasBottom) {
              break;
            }
          }
        }

        const percent = (currentPage / pdfDoc.numPages) * 100;
        progressBar.style.width = `${percent}%`;

        // approximate mapping from pages to sidebar sections
        updateSidebarByPage(currentPage);
      }

      // Page-to-section mapping: each sidebar link mapped to its starting PDF page
      // Updated from the attached PDF (user-provided mapping)
      const sectionPageMap = {
        "executive-summary": 17,
        introduction: 18,
        vision: 19,
        governance: 22,
        infrastructure: 34,
        content: 46,
        capacity: 51,
        curriculum: 56,
        inclusivity: 67,
        innovation: 75,
        cybersecurity: 82,
        "data-management": 94,
        "data-protection": 100,
        experiential: 108,
        monitoring: 123,
        sustainability: 129,
        conclusion: 132,
        definitions: 15,
        abbreviations: 32,
      };

      // Update sidebar highlight based on current PDF page
      function updateSidebarByPage(pageNum) {
        if (!navLinks || navLinks.length === 0) return;

        // Find which section the current page falls into
        let activeSection = null;
        const pageArray = Object.entries(sectionPageMap).sort(
          (a, b) => a[1] - b[1],
        );

        for (let i = pageArray.length - 1; i >= 0; i--) {
          if (pageNum >= pageArray[i][1]) {
            activeSection = pageArray[i][0];
            break;
          }
        }

        // Update active class
        navLinks.forEach((link) => link.classList.remove("active"));
        if (activeSection) {
          const activeLink = document.querySelector(
            `.nav-link[data-section="${activeSection}"]`,
          );
          if (activeLink) activeLink.classList.add("active");
        }
      }

      // Load PDF from asset folder
      const pdfPath = "asset/Strategy Document.pdf";

      // Function to scroll to a specific section/page
      function scrollToSection(sectionId) {
        if (!pdfDoc || !sectionPageMap[sectionId]) return;

        const targetPage = sectionPageMap[sectionId];

        // Wait for the target page to be rendered, then scroll
        const checkAndScroll = () => {
          const canvas = pageCanvases[targetPage];
          if (canvas) {
            canvas.scrollIntoView({ behavior: "smooth", block: "start" });
            // Update sidebar to highlight the section
            updateSidebarByPage(targetPage);
          } else {
            // If page not rendered yet, wait a bit and try again
            setTimeout(checkAndScroll, 100);
          }
        };

        checkAndScroll();
      }

      function loadPdfAndRender() {
        if (!window.pdfjsLib) return;
        pdfjsLib
          .getDocument(pdfPath)
          .promise.then((doc) => {
            pdfDoc = doc;
            // clear existing HTML 'sections' and render pages
            renderAllPages();

            // Check for hash in URL and scroll to section
            const hash = window.location.hash.replace("#", "");
            if (hash && sectionPageMap[hash]) {
              // Wait a bit for pages to start rendering
              setTimeout(() => scrollToSection(hash), 500);
            }
          })
          .catch((err) => {
            console.error("Error loading PDF:", err);
          });
      }

      // Listen to scroll events for progress and lazy rendering
      viewerWrap.addEventListener("scroll", () => {
        updatePageCounter();
      });

      // handle resize: re-render to fit width
      window.addEventListener("resize", () => {
        if (fitToWidth && pdfDoc) {
          // re-render pages to adapt to new width
          renderAllPages();
        }
        if (window.innerWidth > 768) {
          sidebar.classList.remove("active");
        }
      });

      // Start loading the PDF if PDF.js is available
      if (window.pdfjsLib) {
        loadPdfAndRender();
      } else {
        // In rare cases the CDN may fail; attempt to load when available
        window.addEventListener("load", () => {
          if (window.pdfjsLib) loadPdfAndRender();
        });
      }

      // ------------------- end PDF.js integration -------------------

      // Intersection Observer originally used for HTML sections (kept for fallback)
      const observerOptions = {
        root: viewerWrap,
        rootMargin: "-50% 0px -50% 0px",
        threshold: 0,
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const sectionId = entry.target.id;
            // Remove active class from all links
            navLinks.forEach((link) => link.classList.remove("active"));
            // Add active class to corresponding link
            const activeLink = document.querySelector(
              `.nav-link[data-section="${sectionId}"]`,
            );
            if (activeLink) {
              activeLink.classList.add("active");
            }
            // Update reading progress
            updatePageCounter();
          }
        });
      }, observerOptions);

      // Observe all sections (will be no-ops when PDF is rendered and sections removed)
      document.querySelectorAll(".document-section").forEach((section) => {
        observer.observe(section);
      });

      // Smooth scroll to section
      navLinks.forEach((link) => {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          const sectionId = link.getAttribute("data-section");
          const targetPage = sectionPageMap[sectionId];

          if (targetPage && pdfDoc) {
            // Ensure page is rendered
            renderPage(targetPage)
              .then(() => {
                const canvas = pageCanvases[targetPage];
                if (canvas) {
                  canvas.scrollIntoView({ behavior: "smooth", block: "start" });
                }
              })
              .catch(console.error);
          }
        });
      });

      // Read-only protections (unchanged)
      viewerWrap.addEventListener("contextmenu", (e) => e.preventDefault());

      document.addEventListener("keydown", (e) => {
        if (e.ctrlKey || e.metaKey) {
          const blocked = ["s", "p", "S", "P", "c", "C"];
          if (blocked.includes(e.key)) {
            e.preventDefault();
            return false;
          }
        }
      });

      // Prevent drag selection
      viewerWrap.addEventListener("mousedown", (e) => {
        if (e.detail > 1) {
          e.preventDefault();
        }
      });

      // ------------------- Feedback Widget -------------------

      // Section display name mapping
      const sectionDisplayNames = {
        "executive-summary": "Executive Summary",
        introduction: "Introduction",
        vision: "Vision & Mission",
        governance: "Governance & Management",
        infrastructure: "Infrastructure & Connectivity",
        content: "Content Development",
        capacity: "Capacity Building",
        curriculum: "Curriculum Integration",
        inclusivity: "Inclusivity & Access",
        cybersecurity: "Cybersecurity & Data",
        innovation: "Innovation & Learning",
        "data-management": "Data Management & Reporting",
        "data-protection": "Data Protection",
        experiential: "Experiential Learning & Innovations",
        monitoring: "Monitoring & Evaluation",
        sustainability: "Sustainable & Financially Inclusive Systems",
        conclusion: "Conclusion",
        definitions: "Definitions",
        abbreviations: "Abbreviations",
      };

      // Get current document context (page and section)
      function getCurrentDocumentContext() {
        try {
          if (
            !pdfDoc ||
            !pageCanvases ||
            Object.keys(pageCanvases).length === 0
          ) {
            return {
              pageNumber: 0,
              sectionId: "unknown",
              sectionName: "Document",
            };
          }

          const scrollTop = viewerWrap.scrollTop;
          const viewportHeight = viewerWrap.clientHeight;
          let currentPage = 1;

          for (let i = 1; i <= pdfDoc.numPages; i++) {
            const canvas = pageCanvases[i];
            if (
              canvas &&
              scrollTop + viewportHeight * 0.25 >= canvas.offsetTop
            ) {
              currentPage = i;
            }
          }

          // Map page to section
          let currentSection = null;
          const pageArray = Object.entries(sectionPageMap).sort(
            (a, b) => a[1] - b[1],
          );
          for (let i = pageArray.length - 1; i >= 0; i--) {
            if (currentPage >= pageArray[i][1]) {
              currentSection = pageArray[i][0];
              break;
            }
          }

          return {
            pageNumber: currentPage,
            sectionId: currentSection || "unknown",
            sectionName: sectionDisplayNames[currentSection] || "Document",
          };
        } catch (e) {
          console.error("Failed to capture context:", e);
          return {
            pageNumber: 0,
            sectionId: "unknown",
            sectionName: "Document",
          };
        }
      }

      // Feedback Storage utility
      const FeedbackStorage = {
        STORAGE_KEY: "edtech-feedback-entries",
        DEVICE_ID_KEY: "edtech-device-id",

        isAvailable() {
          try {
            const test = "__storage_test__";
            localStorage.setItem(test, test);
            localStorage.removeItem(test);
            return true;
          } catch (e) {
            return false;
          }
        },

        getAll() {
          try {
            const data = localStorage.getItem(this.STORAGE_KEY);
            return data ? JSON.parse(data) : [];
          } catch (e) {
            console.error("Failed to read feedback storage:", e);
            return [];
          }
        },

        add(entry) {
          try {
            const entries = this.getAll();
            entries.push(entry);
            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(entries));
            return entry;
          } catch (e) {
            console.error("Failed to save feedback:", e);
            return null;
          }
        },

        getDeviceId() {
          let deviceId = localStorage.getItem(this.DEVICE_ID_KEY);
          if (!deviceId) {
            deviceId =
              "device_" +
              Date.now() +
              "_" +
              Math.random().toString(36).substring(2, 10);
            localStorage.setItem(this.DEVICE_ID_KEY, deviceId);
          }
          return deviceId;
        },
      };

      // Generate unique feedback ID
      function generateFeedbackId() {
        const timestamp = Date.now();
        const random = Math.random().toString(36).substring(2, 8);
        return "fb_" + timestamp + "_" + random;
      }

      // Validate feedback comment
      function validateFeedback(comment) {
        const trimmed = (comment || "").trim();
        if (!trimmed) {
          return { valid: false, error: "empty_comment" };
        }
        if (trimmed.length > 5000) {
          return { valid: false, error: "too_long" };
        }
        return { valid: true, value: trimmed };
      }

      // FeedbackWidget Class
      class FeedbackWidget {
        constructor() {
          this.isExpanded = false;
          this.capturedContext = null;
          this.elements = {};
          this.focusableElements = [];
        }

        init() {
          // Get element references
          this.elements = {
            widget: document.getElementById("feedback-widget"),
            toggle: document.getElementById("feedback-toggle"),
            panel: document.getElementById("feedback-panel"),
            close: document.getElementById("feedback-close"),
            form: document.getElementById("feedback-form"),
            comment: document.getElementById("feedback-comment"),
            rating: document.getElementById("feedback-rating"),
            submit: document.getElementById("feedback-submit"),
            context: document.getElementById("feedback-context"),
            status: document.getElementById("feedback-status"),
          };

          if (!this.elements.widget) {
            console.error("Feedback widget elements not found");
            return;
          }

          // Set up event listeners
          this.elements.toggle.addEventListener("click", () => this.expand());
          this.elements.close.addEventListener("click", () => this.collapse());
          this.elements.form.addEventListener("submit", (e) =>
            this.handleSubmit(e),
          );

          // Keyboard support
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && this.isExpanded) {
              this.collapse();
            }
          });

          // Focus trap setup
          this.setupFocusTrap();
        }

        setupFocusTrap() {
          this.focusableElements = [
            this.elements.close,
            this.elements.comment,
            this.elements.rating,
            this.elements.submit,
          ];

          this.elements.panel.addEventListener("keydown", (e) => {
            if (e.key !== "Tab" || !this.isExpanded) return;

            const firstEl = this.focusableElements[0];
            const lastEl =
              this.focusableElements[this.focusableElements.length - 1];

            if (e.shiftKey && document.activeElement === firstEl) {
              e.preventDefault();
              lastEl.focus();
            } else if (!e.shiftKey && document.activeElement === lastEl) {
              e.preventDefault();
              firstEl.focus();
            }
          });
        }

        expand() {
          if (this.isExpanded) return;

          // Capture context when expanding
          this.capturedContext = getCurrentDocumentContext();
          this.updateContextDisplay();

          // Update state
          this.isExpanded = true;
          this.elements.panel.classList.add("expanded");
          this.elements.panel.setAttribute("aria-hidden", "false");
          this.elements.toggle.setAttribute("aria-expanded", "true");

          // Focus the textarea
          setTimeout(() => {
            this.elements.comment.focus();
          }, 100);
        }

        collapse() {
          if (!this.isExpanded) return;

          this.isExpanded = false;
          this.elements.panel.classList.remove("expanded");
          this.elements.panel.setAttribute("aria-hidden", "true");
          this.elements.toggle.setAttribute("aria-expanded", "false");

          // Return focus to toggle button
          this.elements.toggle.focus();
        }

        toggle() {
          if (this.isExpanded) {
            this.collapse();
          } else {
            this.expand();
          }
        }

        updateContextDisplay() {
          if (this.capturedContext && this.elements.context) {
            const { pageNumber, sectionName } = this.capturedContext;
            if (pageNumber > 0) {
              this.elements.context.textContent =
                "Viewing: " + sectionName + " (Page " + pageNumber + ")";
              this.elements.context.style.display = "block";
            } else {
              this.elements.context.textContent = "Viewing: Document";
              this.elements.context.style.display = "block";
            }
          }
        }

        async handleSubmit(e) {
          e.preventDefault();

          const comment = this.elements.comment.value;
          const rating = this.elements.rating.value;

          // Validate
          const validation = validateFeedback(comment);
          if (!validation.valid) {
            if (validation.error === "empty_comment") {
              this.showError("Please enter your feedback before submitting.");
            } else if (validation.error === "too_long") {
              this.showError(
                "Feedback is too long. Please keep it under 5000 characters.",
              );
            }
            return;
          }

          // Disable submit button while processing
          this.elements.submit.disabled = true;
          this.elements.submit.textContent = "Sending...";

          // Map rating to backend format
          const ratingMap = {
            very_satisfied: "very satisfied",
            satisfied: "satisfied",
            neutral: "neutral",
            dissatisfied: "dissatisfied",
            very_dissatisfied: "very dissatisfied",
          };

          // Create feedback entry for local storage
          const entry = {
            id: generateFeedbackId(),
            device_id: FeedbackStorage.getDeviceId(),
            comment: validation.value,
            rating: rating || null,
            pageNumber: this.capturedContext
              ? this.capturedContext.pageNumber
              : 0,
            sectionId: this.capturedContext
              ? this.capturedContext.sectionId
              : "unknown",
            timestamp: new Date().toISOString(),
            synced: false,
          };

          // Try to submit to backend
          try {
            const response = await fetch(
              "https://edudoc-610o.onrender.com/api/feedback/submit",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  device_id: entry.device_id,
                  feedback: entry.comment,
                  rating: rating ? ratingMap[rating] : "neutral",
                  source: "document",
                }),
              },
            );

            if (response.ok) {
              entry.synced = true;
              // Save to localStorage as backup
              if (FeedbackStorage.isAvailable()) {
                FeedbackStorage.add(entry);
              }
              this.showConfirmation();
              this.clearForm();
            } else {
              // API failed, save locally for later sync
              if (FeedbackStorage.isAvailable()) {
                FeedbackStorage.add(entry);
              }
              this.showConfirmation(); // Still show success since we saved locally
              this.clearForm();
              console.warn(
                "Backend submission failed, saved locally for later sync",
              );
            }
          } catch (error) {
            console.error("Failed to submit to backend:", error);
            // Save locally as fallback
            if (FeedbackStorage.isAvailable()) {
              FeedbackStorage.add(entry);
            }
            this.showConfirmation(); // Still show success since we saved locally
            this.clearForm();
          }

          // Re-enable submit button
          this.elements.submit.disabled = false;
          this.elements.submit.textContent = "Send Feedback";

          // Collapse after delay
          setTimeout(() => {
            this.collapse();
            this.clearStatus();
          }, 2500);
        }

        clearForm() {
          this.elements.comment.value = "";
          this.elements.rating.value = "";
        }

        showConfirmation() {
          this.elements.status.textContent = "Thanks for your feedback!";
          this.elements.status.className = "feedback-status feedback-success";
        }

        showError(message) {
          this.elements.status.textContent = message;
          this.elements.status.className = "feedback-status feedback-error";
        }

        clearStatus() {
          this.elements.status.textContent = "";
          this.elements.status.className = "feedback-status";
        }
      }

      // ------------------- end Feedback Widget Class -------------------
    </script>

    <!-- Feedback Widget -->
    <div
      id="feedback-widget"
      class="feedback-widget"
      aria-label="Feedback widget"
    >
      <!-- Onboarding Tooltip -->
      <div id="feedback-tooltip" class="feedback-tooltip">
        💬 Share your feedback!
      </div>

      <!-- Collapsed State: Icon Button -->
      <button
        id="feedback-toggle"
        class="feedback-toggle"
        aria-label="Open feedback form"
        aria-expanded="false"
        aria-controls="feedback-panel"
        title="Share your feedback"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
          ></path>
        </svg>
      </button>

      <!-- Expanded State: Form Panel -->
      <div
        id="feedback-panel"
        class="feedback-panel"
        role="dialog"
        aria-labelledby="feedback-title"
        aria-hidden="true"
      >
        <div class="feedback-header">
          <h3 id="feedback-title">Share Feedback</h3>
          <button
            class="feedback-close"
            id="feedback-close"
            aria-label="Close feedback form"
          >
            &times;
          </button>
        </div>

        <div class="feedback-context" id="feedback-context" aria-live="polite">
          <!-- Shows current page/section context -->
        </div>

        <form id="feedback-form" class="feedback-form">
          <div class="feedback-field">
            <label for="feedback-comment">Your feedback</label>
            <textarea
              id="feedback-comment"
              name="comment"
              placeholder="What do you think about this section?"
              rows="3"
              required
            ></textarea>
          </div>

          <div class="feedback-field">
            <label for="feedback-rating">Satisfaction (optional)</label>
            <select id="feedback-rating" name="rating">
              <option value="">-- Select --</option>
              <option value="very_satisfied">Very Satisfied</option>
              <option value="satisfied">Satisfied</option>
              <option value="neutral">Neutral</option>
              <option value="dissatisfied">Dissatisfied</option>
              <option value="very_dissatisfied">Very Dissatisfied</option>
            </select>
          </div>

          <button type="submit" class="feedback-submit" id="feedback-submit">
            Send Feedback
          </button>
        </form>

        <!-- Confirmation/Error Messages -->
        <div
          id="feedback-status"
          class="feedback-status"
          aria-live="assertive"
        ></div>
      </div>
    </div>

    <!-- Initialize Feedback Widget -->
    <script>
      const feedbackWidget = new FeedbackWidget();
      feedbackWidget.init();

      // Onboarding: Show tooltip and pulse on every visit
      (function () {
        const tooltip = document.getElementById("feedback-tooltip");
        const toggle = document.getElementById("feedback-toggle");

        // Show tooltip and start pulse animation after a short delay
        setTimeout(function () {
          if (tooltip && toggle) {
            tooltip.classList.add("visible");
            toggle.classList.add("pulsing");
          }
        }, 1500); // Wait 1.5s after page load

        // Dismiss when user clicks the feedback button
        if (toggle) {
          toggle.addEventListener(
            "click",
            function dismissOnboarding() {
              if (tooltip) tooltip.classList.remove("visible");
              toggle.classList.remove("pulsing");
            },
            { once: true },
          );
        }
      })();
    </script>
  </body>
</html>
